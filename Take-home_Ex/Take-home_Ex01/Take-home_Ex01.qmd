---
title: "Take-home Exercise 1"
author: "Sarthak Nagapurkar"
date: "April 19, 2024"
date-modified: "last-modified"
execute: 
  eval: true
  echo: true
  warning: false
  freeze: true
---

## 1 Overview

### 1.1 Background

There are two major residential property market in Singapore, namely public and private housing. Public housing aims to meet the basic need of the general public with monthly household income less than or equal to S\$14,000. For families with monthly household income more than S\$14,000, they need to turn to the private residential market.

### **1.2 The Task**

Assuming the role of a graphical editor of a median company, this post aims to reveal the insights from private residential market and sub-markets of Singapore for the 1st quarter of 2024.

### **1.3 The Data**

To accomplish the task, transaction data of [REALIS](https://www.ura.gov.sg/reis/index) will be used. A complete set of the private residential property transaction data from 1st January 2023 to 31st March 2024 will be used.

### 1.4 **The Designing Tool**

The data is processed by using appropriate **tidyverse** family of packages and the statistical graphics are prepared using **ggplot2** and its extensions.

## 2 Loading Packages

```{r}
pacman::p_load(ggrepel, patchwork, ggthemes, ggridges, hrbrthemes, tidyverse)
```

## 3 Reading Data

```{r}
realis_data_2023Q1 <- read_csv("data/ResidentialTransaction20240308160536.csv")
realis_data_2023Q1 <- mutate(realis_data_2023Q1, Quarter='2023-Q1')
realis_data_2023Q2 <- read_csv("data/ResidentialTransaction20240308160736.csv")
realis_data_2023Q2 <- mutate(realis_data_2023Q2, Quarter='2023-Q2')
realis_data_2023Q3 <- read_csv("data/ResidentialTransaction20240308161009.csv")
realis_data_2023Q3 <- mutate(realis_data_2023Q3, Quarter='2023-Q3')
realis_data_2023Q4 <- read_csv("data/ResidentialTransaction20240308161109.csv")
realis_data_2023Q4 <- mutate(realis_data_2023Q4, Quarter='2023-Q4')
realis_data_2024Q1 <- read_csv("data/ResidentialTransaction20240414220633.csv")
realis_data_2024Q1 <- mutate(realis_data_2024Q1, Quarter='2024-Q1')

```

```{r}
realis_data <- rbind(realis_data_2023Q1, realis_data_2023Q2, realis_data_2023Q3, realis_data_2023Q4, realis_data_2024Q1)
```

### 3.1 Identify Duplicates

```{r}
sum(duplicated(realis_data))
```

### 3.2 Identify Missing Values

```{r}
sum(is.na(realis_data))

```

```{r}
realis_data <- realis_data %>% 
  drop_na()
sum(is.na(realis_data))
```

### 3.3 Filter Private Housing Data

```{r}
realis_private <- filter(realis_data, `Purchaser Address Indicator` == "Private")
realis_private_2024Q1 <- filter(realis_data_2024Q1, `Purchaser Address Indicator` == "Private")
```

## 4 Visualising data

```{r}
realis_private_qoq <- realis_private %>%
group_by(Quarter) %>%
  summarize(Market = sum(`Transacted Price ($)`))

```

```{r}
realis_private_qoq_type <- realis_private %>%
group_by(Quarter,`Type of Sale`) %>%
  summarize(Market = sum(`Transacted Price ($)`),.groups = 'drop')
realis_private_qoq_type
```

```{r}
realis_private_qoq <- realis_private_qoq %>% mutate(PercentDiff = (`Market` - lag(`Market`)) / lag(`Market`) * 100)
realis_private_qoq_type <- realis_private_qoq %>% mutate(PercentDiff = (`Market` - lag(`Market`)) / lag(`Market`) * 100)
```

::: panel-tabset
## The plot

```{r}
p1 <- ggplot(data = realis_private,
       aes(x = Quarter, y = `Unit Price ($ PSF)`)) +
  geom_boxplot()
p2 <- ggplot(data = realis_private,
       aes(x = Quarter,y = `Transacted Price ($)`))
p1 / p2
```

## The code
:::

::: panel-tabset
## The plot

```{r}
#| echo: false
p1 <- ggplot(data = realis_private_2024Q1,
             aes(colour = `Type of Area`,x = `Unit Price ($ PSF)`)) +
  geom_density(alpha = 0.3) +
  facet_wrap(~ `Type of Sale`, scales = "free_y", nrow = 3)
p2 <- ggplot(data = realis_private_2024Q1,
       aes(x = `Type of Sale`,y = `Unit Price ($ PSF)`)) +
  geom_boxplot() +
  #stat_summary(geom = "point", fun = "mean",, colour = "red") +
  coord_cartesian(ylim=c(500,7000))
p3 <- ggplot(data = realis_private_2024Q1,
       aes(x = `Type of Sale`,y = `Unit Price ($ PSF)`,fill = `Type of Area`)) + 
  geom_boxplot()
p2 / (p1 | p3)
```

## The code

```{r}
#| eval: false
p1 <- ggplot(data = realis_private_2024Q1,
             aes(colour = `Type of Area`,x = `Unit Price ($ PSF)`)) +
  geom_density(alpha = 0.3) +
  facet_wrap(~ `Type of Sale`, scales = "free_y", nrow = 3)
p2 <- ggplot(data = realis_private_2024Q1,
       aes(x = `Type of Sale`,y = `Unit Price ($ PSF)`)) +
  geom_boxplot() +
  #stat_summary(geom = "point", fun = "mean", size=3, colour = "red")
  + coord_cartesian(ylim=c(500,7000))
p3 <- ggplot(data = realis_private__2024Q1,
       aes(x = `Type of Sale`,y = `Unit Price ($ PSF)`,fill = `Type of Area`)) + 
  geom_boxplot()
p2 / (p1 | p3)
```
:::

::: panel-tabset
## The plot

```{r}
p1 <- ggplot(data = realis_private_2024Q1,
             aes(x = `Planning Region`, fill= `Type of Sale`)) +
  geom_bar()
p2 <- ggplot(data = realis_private_2024Q1,
       aes(x = `Unit Price ($ PSF)`,
           y = `Planning Region`,fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  scale_fill_viridis_c(name = "Tail probability", direction = -1) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE)
p3 <- ggplot(data = realis_private_2024Q1,
       aes(x = `Unit Price ($ PSF)`,
           y = `Property Type`,fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  scale_fill_viridis_c(name = "Tail probability", direction = -1) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE)
(p1 / p2) / p3
```

## The code
:::

```{r}

```
